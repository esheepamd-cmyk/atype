<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>@type — мини‑соцсеть</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #e9edf1;
    }
    a { color: #2a5885; }

    /* Шапка */
    .topbar {
      height: 44px;
      background: #4a76a8;
      color: #fff;
      display: flex;
      align-items: center;
      padding: 0 16px;
    }
    .topbar-logo {
      font-weight: 700;
      font-size: 18px;
      margin-right: 16px;
    }
    .topbar-search {
      flex: 1;
    }
    .topbar-search input {
      width: 100%;
      max-width: 260px;
      padding: 4px 8px;
      border-radius: 3px;
      border: none;
      font-size: 13px;
    }
    .topbar-right {
      margin-left: auto;
      font-size: 13px;
      opacity: 0.9;
    }

    /* layout */
    .layout {
      max-width: 960px;
      margin: 12px auto;
      display: grid;
      grid-template-columns: 180px minmax(0, 1fr) 220px;
      gap: 12px;
      padding: 0 8px 24px;
    }

    .left-menu {
      font-size: 13px;
    }
    .left-menu-section {
      margin-bottom: 10px;
      background: #f5f7fa;
      border-radius: 2px;
      padding: 6px 0;
    }
    .left-menu a {
      display: block;
      padding: 3px 10px;
      color: #2a5885;
      text-decoration: none;
      border-radius: 2px;
      cursor: pointer;
    }
    .left-menu a:hover {
      background: #dfe6f1;
    }
    .left-menu .section-title {
      padding: 3px 10px;
      color: #777;
      text-transform: uppercase;
      font-size: 11px;
    }

    .content {
      font-size: 13px;
    }

    .right-column {
      font-size: 12px;
    }

    .card {
      background: #fff;
      border-radius: 2px;
      box-shadow: 0 1px 0 rgba(0,0,0,0.08);
      border: 1px solid #d3dde7;
      margin-bottom: 10px;
    }
    .card-header {
      padding: 6px 8px;
      border-bottom: 1px solid #e5ebf1;
      font-weight: 600;
      font-size: 13px;
      background: #f5f7fa;
    }
    .card-body {
      padding: 8px;
    }

    label {
      display: block;
      margin-bottom: 4px;
      color: #555;
    }

    input[type="text"],
    input[type="password"],
    textarea {
      width: 100%;
      padding: 6px;
      border-radius: 3px;
      border: 1px solid #c5d0db;
      font-size: 13px;
      font-family: inherit;
    }
    textarea {
      resize: vertical;
      min-height: 50px;
      max-height: 150px;
    }

    button {
      border: none;
      border-radius: 3px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
      font-family: inherit;
    }
    .btn-primary {
      background: #4a76a8;
      color: #fff;
    }
    .btn-secondary {
      background: #e5ebf1;
      color: #2a5885;
    }
    .btn-danger {
      background: #e53935;
      color: #fff;
    }
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .posts {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 420px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .post {
      border-radius: 2px;
      padding: 6px 8px;
      background: #f5f7fa;
      border: 1px solid #e5ebf1;
    }
    .post-header {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      font-size: 12px;
      color: #777;
    }
    .post-author {
      font-weight: 600;
      color: #2a5885;
    }
    .post-time {
      white-space: nowrap;
    }
    .post-text {
      margin-top: 4px;
      font-size: 13px;
      color: #000;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .empty {
      font-size: 12px;
      color: #777;
      text-align: center;
      padding: 12px 0;
    }
    .small {
      font-size: 11px;
      color: #888;
      margin-top: 4px;
    }

    /* экраны */
    .page { display: none; }
    .page-active { display: block; }

    @media (max-width: 860px) {
      .layout {
        grid-template-columns: 170px minmax(0, 1fr);
        grid-template-rows: auto auto;
        grid-template-areas:
          "left content"
          "left right";
      }
      .right-column {
        grid-column: 1 / 3;
      }
    }

    @media (max-width: 680px) {
      .layout {
        display: block;
      }
      .left-menu, .right-column {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Шапка -->
  <div class="topbar">
    <div class="topbar-logo">@type</div>
    <div class="topbar-search">
      <input type="text" placeholder="Поиск (пока не работает)">
    </div>
    <div class="topbar-right" id="topbarUser">
      Не авторизован
    </div>
  </div>

  <!-- Экран логина/регистрации -->
  <div id="page-auth" class="page page-active" style="max-width:360px;margin:40px auto;">
    <div class="card">
      <div class="card-header">Вход в @type</div>
      <div class="card-body">
        <label for="loginName">Логин</label>
        <input type="text" id="loginName" placeholder="логин">

        <label for="loginPass" style="margin-top:6px;">Пароль</label>
        <input type="password" id="loginPass" placeholder="пароль">

        <div class="btn-group">
          <button class="btn-primary" id="loginBtn">Войти</button>
          <button class="btn-secondary" id="registerBtn">Зарегистрироваться</button>
        </div>
        <div class="small" id="authHint">
          Аккаунты и пароли хранятся локально в этом браузере (localStorage).
        </div>
      </div>
    </div>
  </div>

  <!-- Основной layout (после входа) -->
  <div id="page-app" class="page">
    <div class="layout">
      <!-- Левое меню -->
      <nav class="left-menu">
        <div class="left-menu-section">
          <div class="section-title">Разделы</div>
          <a data-nav="profile">Моя страница</a>
          <a data-nav="news">Новости</a>
          <a data-nav="messages">Сообщения</a>
        </div>
        <div class="left-menu-section">
          <div class="section-title">@type</div>
          <a data-nav="settings">Настройки</a>
          <a id="logoutLink">Выход</a>
        </div>
      </nav>

      <!-- Центр -->
      <main class="content">
        <!-- страница профиль -->
        <div id="section-profile" class="page page-active">
          <div class="card">
            <div class="card-header">Моя страница</div>
            <div class="card-body">
              <div id="profileInfo"></div>
              <label for="statusInput" style="margin-top:6px;">Статус</label>
              <input type="text" id="statusInput" placeholder="Напишите статус...">
              <div class="btn-group">
                <button class="btn-primary" id="saveStatusBtn">Сохранить статус</button>
              </div>
              <div class="small">
                Профиль и статус привязаны к вашему логину и хранятся в localStorage.
              </div>
            </div>
          </div>
        </div>

        <!-- страница новости -->
        <div id="section-news" class="page">
          <div class="card">
            <div class="card-header">Новый пост</div>
            <div class="card-body">
              <label for="postInput">Что у вас нового?</label>
              <textarea id="postInput" placeholder="Напишите что‑нибудь..."></textarea>
              <div class="btn-group">
                <button class="btn-primary" id="addPostBtn">Отправить</button>
                <button class="btn-secondary" id="clearMyPostsBtn">Очистить мои посты</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Моя лента</div>
            <div class="card-body">
              <div id="postsContainer" class="posts"></div>
            </div>
          </div>
        </div>

        <!-- страница сообщения (заглушка) -->
        <div id="section-messages" class="page">
          <div class="card">
            <div class="card-header">Сообщения</div>
            <div class="card-body">
              <div class="small">
                Здесь позже может появиться простой локальный чат между аккаунтами.
              </div>
            </div>
          </div>
        </div>

        <!-- страница настройки -->
        <div id="section-settings" class="page">
          <div class="card">
            <div class="card-header">Настройки аккаунта</div>
            <div class="card-body">
              <div class="small">
                Здесь можно будет менять пароль или удалять аккаунт.
                Пока доступна только смена статуса на странице профиля.
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Правая колонка -->
      <aside class="right-column">
        <div class="card">
          <div class="card-header">Инфо</div>
          <div class="card-body" id="infoBox">
            Не авторизован.
          </div>
        </div>

        <div class="card">
          <div class="card-header">Подсказка</div>
          <div class="card-body">
            <div class="small">
              @type — учебная мини‑соцсеть.<br>
              Регистрация и логин работают только в этом браузере.
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // Ключи в localStorage
    const STORAGE_KEY_USERS = 'atype_users_v2';
    const STORAGE_KEY_POSTS = 'atype_posts_v2';
    const STORAGE_KEY_CURRENT = 'atype_current_user';

    // DOM
    const pageAuth = document.getElementById('page-auth');
    const pageApp  = document.getElementById('page-app');

    const loginName = document.getElementById('loginName');
    const loginPass = document.getElementById('loginPass');
    const loginBtn  = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    const authHint  = document.getElementById('authHint');

    const topbarUser = document.getElementById('topbarUser');
    const infoBox    = document.getElementById('infoBox');
    const logoutLink = document.getElementById('logoutLink');

    const profileInfo   = document.getElementById('profileInfo');
    const statusInput   = document.getElementById('statusInput');
    const saveStatusBtn = document.getElementById('saveStatusBtn');

    const postInput       = document.getElementById('postInput');
    const addPostBtn      = document.getElementById('addPostBtn');
    const clearMyPostsBtn = document.getElementById('clearMyPostsBtn');
    const postsContainer  = document.getElementById('postsContainer');

    const sections = {
      profile: document.getElementById('section-profile'),
      news: document.getElementById('section-news'),
      messages: document.getElementById('section-messages'),
      settings: document.getElementById('section-settings')
    };

    let users = []; // {login, passHash, status}
    let posts = []; // {author, text, time}
    let currentUser = null; // строка login

    function loadUsers() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY_USERS);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        if (Array.isArray(arr)) return arr;
        return [];
      } catch {
        return [];
      }
    }

    function saveUsers() {
      localStorage.setItem(STORAGE_KEY_USERS, JSON.stringify(users));
    }

    function loadPosts() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY_POSTS);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        if (Array.isArray(arr)) return arr;
        return [];
      } catch {
        return [];
      }
    }

    function savePosts() {
      localStorage.setItem(STORAGE_KEY_POSTS, JSON.stringify(posts));
    }

    function setCurrentUser(login) {
      currentUser = login;
      if (login) {
        localStorage.setItem(STORAGE_KEY_CURRENT, login);
      } else {
        localStorage.removeItem(STORAGE_KEY_CURRENT);
      }
    }

    function getUserByLogin(login) {
      return users.find(u => u.login === login) || null;
    }

    function simpleHash(str) {
      // НЕ безопасно, только для демо
      let h = 0;
      for (let i = 0; i < str.length; i++) {
        h = (h * 31 + str.charCodeAt(i)) | 0;
      }
      return h.toString();
    }

    // Рендер
    function renderAuthState() {
      if (currentUser) {
        pageAuth.classList.remove('page-active');
        pageApp.classList.add('page-active');
        topbarUser.textContent = currentUser;
        infoBox.textContent = 'Вы вошли как ' + currentUser;
        renderProfile();
        renderPosts();
      } else {
        pageAuth.classList.add('page-active');
        pageApp.classList.remove('page-active');
        topbarUser.textContent = 'Не авторизован';
        infoBox.textContent = 'Не авторизован.';
      }
    }

    function renderProfile() {
      if (!currentUser) return;
      const user = getUserByLogin(currentUser);
      if (!user) return;
      profileInfo.innerHTML =
        '<b>Логин:</b> ' + user.login + '<br>' +
        '<b>Статус:</b> ' + (user.status || 'нет статуса');
      statusInput.value = user.status || '';
    }

    function renderPosts() {
      postsContainer.innerHTML = '';
      if (!currentUser) return;
      const myPosts = posts
        .filter(p => p.author === currentUser)
        .sort((a, b) => new Date(b.time) - new Date(a.time));

      if (myPosts.length === 0) {
        const div = document.createElement('div');
        div.className = 'empty';
        div.textContent = 'У вас пока нет постов.';
        postsContainer.appendChild(div);
        return;
      }

      for (const p of myPosts) {
        const postEl = document.createElement('div');
        postEl.className = 'post';

        const header = document.createElement('div');
        header.className = 'post-header';

        const author = document.createElement('span');
        author.className = 'post-author';
        author.textContent = p.author;

        const timeSpan = document.createElement('span');
        timeSpan.className = 'post-time';
        const dt = new Date(p.time || Date.now());
        timeSpan.textContent = dt.toLocaleString();

        header.appendChild(author);
        header.appendChild(timeSpan);

        const text = document.createElement('div');
        text.className = 'post-text';
        text.textContent = p.text;

        postEl.appendChild(header);
        postEl.appendChild(text);
        postsContainer.appendChild(postEl);
      }
    }

    function showSection(name) {
      Object.entries(sections).forEach(([key, el]) => {
        if (key === name) el.classList.add('page-active');
        else el.classList.remove('page-active');
      });
    }

    // Логика: регистрация / вход
    function handleRegister() {
      const login = (loginName.value || '').trim();
      const pass = (loginPass.value || '').trim();
      if (!login || !pass) {
        authHint.textContent = 'Введите логин и пароль для регистрации.';
        return;
      }
      if (getUserByLogin(login)) {
        authHint.textContent = 'Такой логин уже существует.';
        return;
      }
      const user = {
        login,
        passHash: simpleHash(pass),
        status: ''
      };
      users.push(user);
      saveUsers();
      authHint.textContent = 'Аккаунт создан, теперь можно войти.';
    }

    function handleLogin() {
      const login = (loginName.value || '').trim();
      const pass = (loginPass.value || '').trim();
      if (!login || !pass) {
        authHint.textContent = 'Введите логин и пароль.';
        return;
      }
      const user = getUserByLogin(login);
      if (!user) {
        authHint.textContent = 'Аккаунт не найден. Нажмите "Зарегистрироваться".';
        return;
      }
      if (user.passHash !== simpleHash(pass)) {
        authHint.textContent = 'Неверный пароль.';
        return;
      }
      setCurrentUser(login);
      authHint.textContent = '';
      renderAuthState();
      showSection('news');
    }

    function handleLogout() {
      setCurrentUser(null);
      renderAuthState();
    }

    function handleSaveStatus() {
      if (!currentUser) return;
      const user = getUserByLogin(currentUser);
      if (!user) return;
      user.status = statusInput.value || '';
      saveUsers();
      renderProfile();
    }

    function handleAddPost() {
      if (!currentUser) return;
      const text = (postInput.value || '').trim();
      if (!text) {
        alert('Нельзя опубликовать пустой пост.');
        return;
      }
      posts.push({
        author: currentUser,
        text,
        time: new Date().toISOString()
      });
      savePosts();
      postInput.value = '';
      renderPosts();
    }

    function handleClearMyPosts() {
      if (!currentUser) return;
      if (!confirm('Удалить все ваши посты?')) return;
      posts = posts.filter(p => p.author !== currentUser);
      savePosts();
      renderPosts();
    }

    // Навигация по меню
    document.querySelectorAll('.left-menu a[data-nav]').forEach(a => {
      a.addEventListener('click', () => {
        const target = a.getAttribute('data-nav');
        if (!currentUser) return;
        if (target === 'profile') showSection('profile');
        if (target === 'news') showSection('news');
        if (target === 'messages') showSection('messages');
        if (target === 'settings') showSection('settings');
      });
    });

    // События
    registerBtn.addEventListener('click', handleRegister);
    loginBtn.addEventListener('click', handleLogin);
    logoutLink.addEventListener('click', handleLogout);

    saveStatusBtn.addEventListener('click', handleSaveStatus);
    addPostBtn.addEventListener('click', handleAddPost);
    clearMyPostsBtn.addEventListener('click', handleClearMyPosts);

    postInput.addEventListener('keydown', e => {
      if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
        handleAddPost();
      }
    });

    // Инициализация
    users = loadUsers();
    posts = loadPosts();
    const savedUser = localStorage.getItem(STORAGE_KEY_CURRENT);
    if (savedUser && getUserByLogin(savedUser)) {
      currentUser = savedUser;
    }
    renderAuthState();
  </script>
</body>
</html>
